---
layout: post
title: Syncing a Google Sheets Table with a Wordpress Table
subtitle: American Solar Challenge Team Status Board
author: Jonathan Mullen
categories: solar car
tags:
  - solar car
  - wordpress
  - google apps script
---

## Why do this?

I volunteer on the staff of the [American Solar Challenge](https://www.americansolarchallenge.org/) where one of the things I do is maintain the website. Prior to the event, the teams are required to submit various paperwork, fees, and reports in order to participate in the event. The various staff responsible for reviewing these submissions keep track of these submissions in a shared google drive with a google sheet tracking the overall status. The status information is published publicly for teams to see their status and which competitors are registering to compete. The website is hosted on wordpress. So the goal is to keep this up to date regularly without me in the loop. Otherwise the other staff get emails asking why the website is not showing the corret status. 

## How to accomplish this?

To accomplish this some code will need to be running on a server to do the update. Since the data is coming from a Google Sheets spreadsheet an obvious choice is [Google Apps Script](https://developers.google.com/apps-script). This is a scripting tool for google drive that allows you to interact with various documents. Our setup will be one of the more simple setups where a single script needs to interact with a single document, so the script can be created from the Extensions -> Apps Script menu in this document. The google apps script will read the data from the spreadsheet and turn it into what we want to display on wordpress. 

## Getting it into Wordpress

The [Wordpress REST API](https://developer.wordpress.org/rest-api/) will be used to update the data on the wordpress page. The api needs to be enabled from wordpress and potentially with your hosting provider to be used. Once you have done this you should navigate to Users -> Profile in the wordpress dashboard and scroll down to create an application password. This is the password to use to access the API in conjunction with your normal username. 

In Wordpress we will also need to create the page, if it doesn't already exist, and note down the page ID. To get this you can open the page editor and look in the url which will have the query string `post=####` where #### is the page ID. 

We will also need to prepare the page for the update. In my case, we only want to update a segment of the page. In order to track where this segment is I have used two HTML comments to mark the start and end of the page sement which we should update the content within:

```html
<!-- AUTO GEN CONTENT -->
 [CONTENT TO UPDATE]
 <!-- AUTO GEN CONTENT -->
```
_Note: The Wordpress Block Editor has a habit of breaking pages updated this way. I always use the classic editor or code editor to edit these pages._

Then in google apps script we will use these comments to define where to put our generated content. If you have multiple segments in the page to update, simply use different comments for each. I also usually create the content I want to generate first in wordpress so I can just copy and paste all the styling rather than writing it out myself. At this point we have what we need from wordpress and can get to work in the google apps script. 

## Implementation

Back in our Google Apps Script Project we will have a file called code.gs. Feel free to rename it, the name is not important. At the top we will start with some constants needed:

```js
// Wordpress Page / Login Info
const page_id = id
const api_url = 'https://americansolarchallenge.org/wp-json/wp/v2/pages/[id]'
const wordpress_user = '[username]'
const table_identifier = "<!-- AUTO GEN CONTENT -->"
```


### Content Template

To more easily create our HTML content we will use Google Apps Script [Templated HTML](https://developers.google.com/apps-script/guides/html/templates) feature. 

### Pushing to Wordpress

### Putting it together

### Triggers

Lastly, we need to define when this will run. In my use case we want two options - it will automatically run at night a few times a week (I adjust this as the event gets closer eventually automatically updating at least once per day) and be manually triggerable in the spreadsheet. For the manual trigger we will add a menu button by adding the following function: 

```js
// Runs when the spreadsheet starts, adds a tab at the top
function onOpen() {
  var ui = SpreadsheetApp.getUi();
  ui.createMenu('Publish to Website ðŸ“¢')
    .addItem('Update Table', 'updateTable')
    .addToUi();
}
```
Google Apps Script will automatically run the `onOpen()` function when the spreadsheet is opened and a new tab will be added to the menu with one dropdown item users can click called "Update Table". When clicked this will run our function `updateTable()`. _Note: The first time a user runs this they will need to click accept/OK on some prompts allowing the script to access the data via their account. They will then have to click run again before it actually runs_

For our second trigger we navigate to the Triggers page in Google Apps Script and add a new time driven trigger. Select the interval you want and link it to the `updateTable()` function. 

### Improving UI